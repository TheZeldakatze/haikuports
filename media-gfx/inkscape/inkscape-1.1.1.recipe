SUMMARY="A free & open source vector graphics editor"
DESCRIPTION="Inkscape is a Free and open source vector graphics editor. It offers a rich set \
of features and is widely used for both artistic and technical illustrations \
such as cartoons, clip art, logos, typography, diagramming and flowcharting. \
It uses vector graphics to allow for sharp printouts and renderings at \
unlimited resolution and is not bound to a fixed number of pixels like raster \
graphics. Inkscape uses the standardized SVG file format as its main format, \
which is supported by many other applications including web browsers."
HOMEPAGE="https://inkscape.org/"
COPYRIGHT="2021 Inkscape Developers"
LICENSE="GNU GPL v2"
REVISION="1"
SOURCE_URI="https://inkscape.org/gallery/item/29255/inkscape-$portVersion.tar.xz"
CHECKSUM_SHA256="aeca0b9d33b5b1cfa9aa70433bdee6a8c3d020ffafc2e6f0c9a60eed7a7978af"
SOURCE_DIR="inkscape-1.1.1_2021-09-20_3bf5ae0d25"
PATCHES="inkscape-$portVersion.patchset"

# disabled: crashes on startup for various reasons
ARCHITECTURES="?all !x86_gcc2"
SECONDARY_ARCHITECTURES="?x86"

PROVIDES="
	inkscape$secondaryArchSuffix = $portVersion
	app:inkscape$secondaryArchSuffix = $portVersion
	"
REQUIRES="
	haiku$secondaryArchSuffix
	boehm_gc$secondaryArchSuffix
	lib:libgtkmm_3.0$secondaryArchSuffix
	lib:libboost_filesystem$secondaryArchSuffix
	lib:liblcms2$secondaryArchSuffix
	lib:libfontconfig$secondaryArchSuffix
	lib:libpango_1.0$secondaryArchSuffix
	lib:libsoup_2.4$secondaryArchSuffix
	lib:libgsl$secondaryArchSuffix
	lib:libdouble_conversion$secondaryArchSuffix
	lib:libpotrace$secondaryArchSuffix
	lib:libxslt$secondaryArchSuffix

	# so gdk-pixbuf can load SVG icons
	librsvg$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	boehm_gc${secondaryArchSuffix}_devel
	devel:libgtkmm_3.0$secondaryArchSuffix
	devel:libboost_filesystem$secondaryArchSuffix
	devel:liblcms2$secondaryArchSuffix
	devel:libfontconfig$secondaryArchSuffix
	devel:libpango_1.0$secondaryArchSuffix
	devel:libsoup_2.4$secondaryArchSuffix
	devel:libgsl$secondaryArchSuffix
	devel:libdouble_conversion$secondaryArchSuffix
	devel:libpotrace$secondaryArchSuffix
	devel:libxslt$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:cmake
	cmd:g++$secondaryArchSuffix
	cmd:ninja
	cmd:pkg_config$secondaryArchSuffix
	"

BUILD()
{
	LDFLAGS="-Wl,--as-needed" \
	cmake . -GNinja -DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_INSTALL_PREFIX=$appsDir/Inkscape

	# otherwise it runs out of memory, unfortunately
	ninja -j1
}

INSTALL()
{
	ninja install

	mv $appsDir/Inkscape/bin/inkscape $appsDir/Inkscape/Inkscape
	mv $appsDir/Inkscape/bin/inkview $appsDir/Inkscape/inkview
	mv $appsDir/Inkscape/lib/inkscape/* $appsDir/Inkscape/lib/
	rm -rf $appsDir/Inkscape/lib/inkscape
	rm -rf $appsDir/Inkscape/lib/cmake
	rm -rf $appsDir/Inkscape/include

	addAppDeskbarSymlink $appsDir/Inkscape/Inkscape
}
