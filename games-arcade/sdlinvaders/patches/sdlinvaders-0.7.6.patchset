From fbe17a7a031bfc9ce9efd6c4d0fdcbc81c329232 Mon Sep 17 00:00:00 2001
From: Victor Gamper <victor@wenzeslaus.de>
Date: Sun, 12 Dec 2021 22:33:39 +0100
Subject: switch the workdir to the data directory


diff --git a/main.c b/main.c
index f4f650b..0928de6 100644
--- a/main.c
+++ b/main.c
@@ -24,6 +24,7 @@
 #include "music.h"
 
 #define TICKS  30
+#define HIGHSCORE_FILE "/boot/system/settings/sdlinvaders/highscores"
 
 /* The images */
 extern SDL_Surface *screen;
@@ -773,7 +774,7 @@ void save_scores ()
   int i;
   char filename[100];
        
-  sprintf (filename, "data/highscores");
+  sprintf (filename, HIGHSCORE_FILE);
 
   file = fopen(filename, "w");
 
@@ -800,7 +801,7 @@ void show_highscore ()
   int i;
   char filename[100];
        
-  sprintf (filename, "data/highscores");
+  sprintf (filename, HIGHSCORE_FILE);
 
   file = fopen(filename, "r");
 
@@ -831,6 +832,9 @@ void show_highscore ()
 int main(int argc, char *argv[])
 {
   int quit = 0;
+  
+  /* HACK: change the directory to the data directory of Haiku */
+  chdir("/boot/system/data/sdlinvaders/");	
 
   printf("\nSDLInvaders Version %s\n\n",VERSION);
 
-- 
2.30.2


From a18fa09bff0feb4efc129d148ff95d291d754118 Mon Sep 17 00:00:00 2001
From: Victor Gamper <victor@wenzeslaus.de>
Date: Mon, 13 Dec 2021 17:53:22 +0100
Subject: Use find_directory instead of hard coded paths


diff --git a/main.c b/main.c
index 0928de6..7e9586a 100644
--- a/main.c
+++ b/main.c
@@ -17,6 +17,8 @@
 */
 #include <time.h>
 #include <errno.h>
+#include <FindDirectory.h>
+#include <fs_info.h>
 #include "common.h"
 #include "graphics.h"
 #include "alien.h"
@@ -24,7 +26,8 @@
 #include "music.h"
 
 #define TICKS  30
-#define HIGHSCORE_FILE "/boot/system/settings/sdlinvaders/highscores"
+#define HIGHSCORE_FILE "/sdlinvaders/highscores"
+char* highscore_file_path = "";
 
 /* The images */
 extern SDL_Surface *screen;
@@ -774,7 +777,7 @@ void save_scores ()
   int i;
   char filename[100];
        
-  sprintf (filename, HIGHSCORE_FILE);
+  sprintf (filename, highscore_file_path);
 
   file = fopen(filename, "w");
 
@@ -801,7 +804,7 @@ void show_highscore ()
   int i;
   char filename[100];
        
-  sprintf (filename, HIGHSCORE_FILE);
+  sprintf (filename, highscore_file_path);
 
   file = fopen(filename, "r");
 
@@ -833,8 +836,19 @@ int main(int argc, char *argv[])
 {
   int quit = 0;
   
+  dev_t volume = dev_for_path("/boot");
+  char buffer[B_PATH_NAME_LENGTH+B_FILE_NAME_LENGTH];
+  status_t result;
+  result = find_directory(B_SYSTEM_DATA_DIRECTORY, volume, false, buffer, sizeof(buffer));
+  strcat(buffer, "/sdlinvaders/");
+  
   /* HACK: change the directory to the data directory of Haiku */
-  chdir("/boot/system/data/sdlinvaders/");	
+  chdir(buffer);
+  
+  /* set the highscore position */
+  highscore_file_path = malloc(strlen(buffer + strlen(HIGHSCORE_FILE) + 1));
+  strcpy(highscore_file_path, buffer);
+  strcat(highscore_file_path, HIGHSCORE_FILE);
 
   printf("\nSDLInvaders Version %s\n\n",VERSION);
 
-- 
2.30.2

